"use strict";var pe=Object.create;var P=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var ge=(t,e)=>{for(var r in e)P(t,r,{get:e[r],enumerable:!0})},J=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of me(e))!ye.call(t,s)&&s!==r&&P(t,s,{get:()=>e[s],enumerable:!(o=he(e,s))||o.enumerable});return t};var we=(t,e,r)=>(r=t!=null?pe(de(t)):{},J(e||!t||!t.__esModule?P(r,"default",{value:t,enumerable:!0}):r,t)),be=t=>J(P({},"__esModule",{value:!0}),t);var Se={};ge(Se,{activate:()=>Te,deactivate:()=>ke});module.exports=be(Se);var S=we(require("vscode")),U=require("vscode");var k=require("vscode");var L="abcdefghijklmnopqrstuvwxyz";function V(t){if(t<0||!Number.isInteger(t))throw new Error("Input must be a non-negative integer.");let e=Math.floor(t/L.length),r=L[t%L.length];return"z".repeat(e)+r}function K(t){return t===void 0?!0:typeof t=="string"||Array.isArray(t)?t.length===0:typeof t=="object"&&t!==null?Object.keys(t).length===0:!1}var x=class extends Error{constructor(e,r,o){let s=e.status||e.status===0?e.status:"",n=e.statusText||"",i=`${s} ${n}`.trim(),a=i?`status code ${i}`:"an unknown error";super(`Request failed with ${a}: ${r.method} ${r.url}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=e,this.request=r,this.options=o}};var d=class extends Error{constructor(e){super(`Request timed out: ${e.method} ${e.url}`),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=e}};var v=t=>t!==null&&typeof t=="object";var _=(...t)=>{for(let e of t)if((!v(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return q({},...t)},$=(t={},e={})=>{let r=new globalThis.Headers(t),o=e instanceof globalThis.Headers,s=new globalThis.Headers(e);for(let[n,i]of s.entries())o&&i==="undefined"||i===void 0?r.delete(n):r.set(n,i);return r},q=(...t)=>{let e={},r={};for(let o of t)if(Array.isArray(o))Array.isArray(e)||(e=[]),e=[...e,...o];else if(v(o)){for(let[s,n]of Object.entries(o))v(n)&&s in e&&(n=q(e[s],n)),e={...e,[s]:n};v(o.headers)&&(r=$(r,o.headers),e.headers=r)}return e};var W=(()=>{let t=!1,e=!1,r=typeof globalThis.ReadableStream=="function",o=typeof globalThis.Request=="function";if(r&&o)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(s){if(s instanceof Error&&s.message==="unsupported BodyInit type")return!1;throw s}return t&&!e})(),Y=typeof globalThis.AbortController=="function",X=typeof globalThis.ReadableStream=="function",G=typeof globalThis.FormData=="function",I=["get","post","put","patch","head","delete"],xe=()=>{};xe();var Q={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},j=2147483647,A=Symbol("stop"),Z={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},ee={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0};var re=t=>I.includes(t)?t.toUpperCase():t,ve=["get","put","head","delete","options","trace"],_e=[408,413,429,500,502,503,504],oe=[413,429,503],te={limit:2,methods:ve,statusCodes:_e,afterStatusCodes:oe,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:t=>.3*2**(t-1)*1e3},se=(t={})=>{if(typeof t=="number")return{...te,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...te,...t,afterStatusCodes:oe}};async function H(t,e,r,o){return new Promise((s,n)=>{let i=setTimeout(()=>{r&&r.abort(),n(new d(t))},o.timeout);o.fetch(t,e).then(s).catch(n).then(()=>{clearTimeout(i)})})}async function B(t,{signal:e}){return new Promise((r,o)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",s,{once:!0}));function s(){clearTimeout(n),o(e.reason)}let n=setTimeout(()=>{e?.removeEventListener("abort",s),r()},t)})}var ne=(t,e)=>{let r={};for(let o in e)!(o in ee)&&!(o in Z)&&!(o in t)&&(r[o]=e[o]);return r};var E=class t{static create(e,r){let o=new t(e,r),s=async()=>{if(typeof o._options.timeout=="number"&&o._options.timeout>j)throw new RangeError(`The \`timeout\` option cannot be greater than ${j}`);await Promise.resolve();let a=await o._fetch();for(let c of o._options.hooks.afterResponse){let u=await c(o.request,o._options,o._decorateResponse(a.clone()));u instanceof globalThis.Response&&(a=u)}if(o._decorateResponse(a),!a.ok&&o._options.throwHttpErrors){let c=new x(a,o.request,o._options);for(let u of o._options.hooks.beforeError)c=await u(c);throw c}if(o._options.onDownloadProgress){if(typeof o._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!X)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return o._stream(a.clone(),o._options.onDownloadProgress)}return a},i=o._options.retry.methods.includes(o.request.method.toLowerCase())?o._retry(s):s();for(let[a,c]of Object.entries(Q))i[a]=async()=>{o.request.headers.set("accept",o.request.headers.get("accept")||c);let f=(await i).clone();if(a==="json"){if(f.status===204||(await f.clone().arrayBuffer()).byteLength===0)return"";if(r.parseJson)return r.parseJson(await f.text())}return f[a]()};return i}constructor(e,r={}){Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=e;let o=this._input instanceof Request&&"credentials"in Request.prototype?this._input.credentials:void 0;if(this._options={...o&&{credentials:o},...r,headers:$(this._input.headers,r.headers),hooks:q({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:re(r.method??this._input.method),prefixUrl:String(r.prefixUrl||""),retry:se(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(Y){if(this.abortController=new globalThis.AbortController,this._options.signal){let s=this._options.signal;this._options.signal.addEventListener("abort",()=>{this.abortController.abort(s.reason)})}this._options.signal=this.abortController.signal}if(W&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=this._options.stringifyJson?.(this._options.json)??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){let n="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),i=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,n);(G&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(i,{...this.request}),this._options)}}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount<=this._options.retry.limit&&!(e instanceof d)){if(e instanceof x){if(!this._options.retry.statusCodes.includes(e.response.status))return 0;let o=e.response.headers.get("Retry-After");if(o&&this._options.retry.afterStatusCodes.includes(e.response.status)){let s=Number(o)*1e3;Number.isNaN(s)&&(s=Date.parse(o)-Date.now());let n=this._options.retry.maxRetryAfter??s;return s<n?s:n}if(e.response.status===413)return 0}let r=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,r)}return 0}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(r){let o=Math.min(this._calculateRetryDelay(r),j);if(o!==0&&this._retryCount>0){await B(o,{signal:this._options.signal});for(let s of this._options.hooks.beforeRetry)if(await s({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===A)return;return this._retry(e)}throw r}}async _fetch(){for(let o of this._options.hooks.beforeRequest){let s=await o(this.request,this._options);if(s instanceof Request){this.request=s;break}if(s instanceof Response)return s}let e=ne(this.request,this._options),r=this.request;return this.request=r.clone(),this._options.timeout===!1?this._options.fetch(r,e):H(r,e,this.abortController,this._options)}_stream(e,r){let o=Number(e.headers.get("content-length"))||0,s=0;return e.status===204?(r&&r({percent:1,totalBytes:o,transferredBytes:s},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(n){let i=e.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:o},new Uint8Array);async function a(){let{done:c,value:u}=await i.read();if(c){n.close();return}if(r){s+=u.byteLength;let f=o===0?0:s/o;r({percent:f,transferredBytes:s,totalBytes:o},u)}n.enqueue(u),await a()}await a()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}};var z=t=>{let e=(r,o)=>E.create(r,_(t,o));for(let r of I)e[r]=(o,s)=>E.create(o,_(t,s,{method:r}));return e.create=r=>z(_(r)),e.extend=r=>z(_(t,r)),e.stop=A,e},Ee=z(),ie=Ee;var Ce="https://index.crates.io";async function ae(t,e=Ce){let r=t.replace(/"/g,"").toLocaleLowerCase(),o="";r.length<=2?o=r.length.toString():r.length===3?o="3/"+r.substring(0,1):o=r.substring(0,2)+"/"+r.substring(2,4);let s=await ie.get(`${e}/${o}/${r}`);if(s.status!==200)throw new Error(`get crates metadata error: statusCode=${s.status} ${await s.text()}`);let n=(await s.text()).split(`
`).filter(f=>f),i=[],a={},c={},u=[];for(let f of n){let l=JSON.parse(f);l.yanked===!1&&(i.push(l.vers),l.rust_version&&(c[l.vers]=l.rust_version),a[l.vers]=Object.keys(l.features).filter(p=>p==="default"?(u=l.features[p],!1):!0))}return i=i.reverse(),{name:t,versions:i,features:a,defaultFeatures:u,rustVersion:c,createdAt:new Date().getUTCMilliseconds()}}async function ue(t,e){let r=Re(e),o=t.globalState.get(r);if(!o||o.createdAt>new Date().getUTCMilliseconds()-1e3*60*10){let s=await ae(e);return t.globalState.update(r,s),s}return o}function Re(t){return`crates-cmp:metadata:${t}`}async function le(t,e){return(await ue(t,e)).versions}var C=Symbol("None"),R=class t{val;constructor(e){this.val=e}get[Symbol.toStringTag](){return"Option"}*[Symbol.iterator](){this.isSome()&&(yield this.val)}isSome(){return this.val!==C}isNone(){return this.val===C}expect(e){if(this.isNone())throw new Error(e);return this.val}unwrap(){if(this.isNone())throw new Error("Unwrap called on None");return this.val}unwrapOr(e){return this.isNone()?e:this.val}unwrapOrElse(e){return this.isNone()?e():this.val}map(e){return this.isSome()?new t(e(this.val)):this}mapOr(e,r){return this.isSome()?r(this.val):e}or(e){return this.isSome()?this:e}okOr(e){return this.isSome()?y(this.val):g(e)}peek(){return this.val}flatten(){return this.val instanceof t?this.val:this}static from(e){let r=e();return r==null?new t(C):new t(r)}static async fromAsync(e){let r=await e();return r==null?new t(C):new t(r)}};function N(t){return new R(t)}Object.defineProperty(N,Symbol.hasInstance,{value:t=>typeof t!="object"?!1:t?.isSome()||!1});function D(){return new R(C)}Object.defineProperty(D,Symbol.hasInstance,{value:t=>typeof t!="object"?!1:t?.isNone()||!1});var w=class t{val;constructor(e){this.val=e}get[Symbol.toStringTag](){return"Result"}*[Symbol.iterator](){this.isOk()&&(yield this.val)}isOk(){return!(this.val instanceof Error||this.val&&typeof this.val=="object"&&Error.isPrototypeOf(this.val))}isErr(){return this.val instanceof Error||this.val&&typeof this.val=="object"&&Error.isPrototypeOf(this.val)}formatError(e){throw e.stack=`${e.message}: ${this.val.stack?`
	`+this.val.stack.split(`
`).join(`
	`):this.val.message}`,e}expect(e){return this.isErr()&&this.formatError(new Error(e)),this.val}expectErr(e){return this.isOk()&&this.formatError(new Error(e)),this.val}unwrap(){return this.isErr()&&this.formatError(new Error(`Unwrap called on ${this.val.name}`)),this.val}unwrapErr(){if(this.isOk())throw new Error(`UnwrapError called on value - ${this.val}`);return this.val}unwrapOr(e){return this.isErr()?e:this.val}unwrapOrElse(e){return this.isErr()?e(this.val):this.val}map(e){return this.isOk()?new t(e(this.val)):this}mapErr(e){return this.isOk()?this:new t(e(this.val))}mapOr(e,r){return this.isOk()?r(this.val):e}or(e){return this.isOk()?this:e}ok(){return this.isOk()?N(this.val):D()}peek(){return this.val}throw(){if(this.isErr())throw this.val}flatten(){return this.val instanceof t?this.val:this}static from(e){try{return new t(e())}catch(r){return new t(r)}}static async fromAsync(e){try{return new t(await e())}catch(r){return new t(r)}}static partition(e){return e.reduce((r,o)=>(o.isOk()?r.ok.push(o.unwrap()):r.err.push(o.unwrapErr()),r),{ok:[],err:[]})}};function y(t){return new w(t)}Object.defineProperty(y,Symbol.hasInstance,{value:t=>typeof t!="object"?!1:t?.isOk()||!1});function g(t){return typeof t=="string"?new w(new Error(t)):new w(t)}Object.defineProperty(g,Symbol.hasInstance,{value:t=>typeof t!="object"?!1:t?.isErr()||!1});async function T(t){try{let e=await t;return y(e)}catch(e){return g(e)}}var h=require("vscode");async function F(t,e,r){let o=await T(le(t,e));if(o.isErr())return h.window.showErrorMessage(o.unwrapErr().message),[];let s=o.unwrap().map((n,i)=>{let a=new h.CompletionItem(n,h.CompletionItemKind.Constant);return a.insertText=n,a.sortText=V(i++),a.preselect=i===0,a.range=r,a});return new h.CompletionList(s)}var ce=require("vscode");function fe(t,e){return new Promise((r,o)=>{ce.commands.executeCommand(t,e).then(s=>{K(s)&&o("symbol provider undefined"),r(s)},s=>o(s))})}var M=class{context;constructor(e){this.context=e}provideCompletionItems(e,r,o,s){return new Promise(async n=>{let i=await this.completionItems(e,r,o,s);n(i)})}async completionItems(e,r,o,s){let n=await T(fe("vscode.executeDocumentSymbolProvider",e.uri));if(n.isErr())return k.window.showErrorMessage("Require `Even Better TOML` extension"),[];let i=n.unwrap(),a=!1,c=!1,u,f,l,p;for(let b of i)if(b.name.includes("dependencies")&&(a=!0,b.range.contains(r)&&b.children&&b.children.length>0)){for(let m of b.children)if(m.range.contains(r)&&(u=m.name,f=m.range,m.children&&m.children.length>0)){c=!0;for(let O of m.children)O.name==="version"&&(l=O),O.name==="features"&&(p=O)}}return a?(console.log("crateName: ",u),console.log("versionNode: ",l),console.log("featuresNode: ",p),u?l&&l.range.contains(r)?await F(this.context,u,new k.Range(l.range?.start.translate(0,1),l.range?.end.translate(0,-1))):p&&p.range.contains(r)?(console.log("you are typing features"),[]):c?[]:await F(this.context,u,new k.Range(f?.start.translate(0,1),f?.end.translate(0,-1))):(console.log("you are typing crate name"),[])):[]}};function Te(t){let e={language:"toml",pattern:"**/[Cc]argo.toml"};console.log('Congratulations, your extension "crates-cmp" is now active!'),t.subscriptions.push(U.workspace.onDidChangeTextDocument(o=>{}),U.languages.registerCompletionItemProvider(e,new M(t),"'",'"',".","+","-","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"));let r=S.commands.registerCommand("crates-cmp.helloWorld",()=>{S.window.showInformationMessage("Hello World from crates-cmp!")});t.subscriptions.push(r)}function ke(){}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

ky/distribution/index.js:
  (*! MIT License © Sindre Sorhus *)
*/
