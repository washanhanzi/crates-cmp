"use strict";var bt=Object.create;var I=Object.defineProperty;var vt=Object.getOwnPropertyDescriptor;var Ct=Object.getOwnPropertyNames;var Et=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty;var _t=(e,t)=>{for(var r in t)I(e,r,{get:t[r],enumerable:!0})},X=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ct(t))!Rt.call(e,n)&&n!==r&&I(e,n,{get:()=>t[n],enumerable:!(o=vt(t,n))||o.enumerable});return e};var Tt=(e,t,r)=>(r=e!=null?bt(Et(e)):{},X(t||!e||!e.__esModule?I(r,"default",{value:e,enumerable:!0}):r,e)),St=e=>X(I({},"__esModule",{value:!0}),e);var Ut={};_t(Ut,{activate:()=>Lt,deactivate:()=>Mt});module.exports=St(Ut);var Dt=Tt(require("vscode")),H=require("vscode");var xt=require("vscode");var J="abcdefghijklmnopqrstuvwxyz";function b(e){if(e<0||!Number.isInteger(e))throw new Error("Input must be a non-negative integer.");let t=Math.floor(e/J.length),r=J[e%J.length];return"z".repeat(t)+r}function G(e){return e===void 0?!0:typeof e=="string"||Array.isArray(e)?e.length===0:typeof e=="object"&&e!==null?Object.keys(e).length===0:!1}function q(e){return'"'+e+'"'}var _=class extends Error{constructor(t,r,o){let n=t.status||t.status===0?t.status:"",s=t.statusText||"",a=`${n} ${s}`.trim(),i=a?`status code ${a}`:"an unknown error";super(`Request failed with ${i}: ${r.method} ${r.url}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=t,this.request=r,this.options=o}};var v=class extends Error{constructor(t){super(`Request timed out: ${t.method} ${t.url}`),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=t}};var T=e=>e!==null&&typeof e=="object";var S=(...e)=>{for(let t of e)if((!T(t)||Array.isArray(t))&&t!==void 0)throw new TypeError("The `options` argument must be an object");return j({},...e)},V=(e={},t={})=>{let r=new globalThis.Headers(e),o=t instanceof globalThis.Headers,n=new globalThis.Headers(t);for(let[s,a]of n.entries())o&&a==="undefined"||a===void 0?r.delete(s):r.set(s,a);return r},j=(...e)=>{let t={},r={};for(let o of e)if(Array.isArray(o))Array.isArray(t)||(t=[]),t=[...t,...o];else if(T(o)){for(let[n,s]of Object.entries(o))T(s)&&n in t&&(s=j(t[n],s)),t={...t,[n]:s};T(o.headers)&&(r=V(r,o.headers),t.headers=r)}return t};var Z=(()=>{let e=!1,t=!1,r=typeof globalThis.ReadableStream=="function",o=typeof globalThis.Request=="function";if(r&&o)try{t=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type")}catch(n){if(n instanceof Error&&n.message==="unsupported BodyInit type")return!1;throw n}return e&&!t})(),tt=typeof globalThis.AbortController=="function",et=typeof globalThis.ReadableStream=="function",rt=typeof globalThis.FormData=="function",A=["get","post","put","patch","head","delete"],kt=()=>{};kt();var ot={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},N=2147483647,D=Symbol("stop"),nt={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},st={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0};var at=e=>A.includes(e)?e.toUpperCase():e,Ot=["get","put","head","delete","options","trace"],Pt=[408,413,429,500,502,503,504],ut=[413,429,503],it={limit:2,methods:Ot,statusCodes:Pt,afterStatusCodes:ut,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:e=>.3*2**(e-1)*1e3},lt=(e={})=>{if(typeof e=="number")return{...it,limit:e};if(e.methods&&!Array.isArray(e.methods))throw new Error("retry.methods must be an array");if(e.statusCodes&&!Array.isArray(e.statusCodes))throw new Error("retry.statusCodes must be an array");return{...it,...e,afterStatusCodes:ut}};async function z(e,t,r,o){return new Promise((n,s)=>{let a=setTimeout(()=>{r&&r.abort(),s(new v(e))},o.timeout);o.fetch(e,t).then(n).catch(s).then(()=>{clearTimeout(a)})})}async function F(e,{signal:t}){return new Promise((r,o)=>{t&&(t.throwIfAborted(),t.addEventListener("abort",n,{once:!0}));function n(){clearTimeout(s),o(t.reason)}let s=setTimeout(()=>{t?.removeEventListener("abort",n),r()},e)})}var ct=(e,t)=>{let r={};for(let o in t)!(o in st)&&!(o in nt)&&!(o in e)&&(r[o]=t[o]);return r};var k=class e{static create(t,r){let o=new e(t,r),n=async()=>{if(typeof o._options.timeout=="number"&&o._options.timeout>N)throw new RangeError(`The \`timeout\` option cannot be greater than ${N}`);await Promise.resolve();let i=await o._fetch();for(let l of o._options.hooks.afterResponse){let u=await l(o.request,o._options,o._decorateResponse(i.clone()));u instanceof globalThis.Response&&(i=u)}if(o._decorateResponse(i),!i.ok&&o._options.throwHttpErrors){let l=new _(i,o.request,o._options);for(let u of o._options.hooks.beforeError)l=await u(l);throw l}if(o._options.onDownloadProgress){if(typeof o._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!et)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return o._stream(i.clone(),o._options.onDownloadProgress)}return i},a=o._options.retry.methods.includes(o.request.method.toLowerCase())?o._retry(n):n();for(let[i,l]of Object.entries(ot))a[i]=async()=>{o.request.headers.set("accept",o.request.headers.get("accept")||l);let f=(await a).clone();if(i==="json"){if(f.status===204||(await f.clone().arrayBuffer()).byteLength===0)return"";if(r.parseJson)return r.parseJson(await f.text())}return f[i]()};return a}constructor(t,r={}){Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=t;let o=this._input instanceof Request&&"credentials"in Request.prototype?this._input.credentials:void 0;if(this._options={...o&&{credentials:o},...r,headers:V(this._input.headers,r.headers),hooks:j({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:at(r.method??this._input.method),prefixUrl:String(r.prefixUrl||""),retry:lt(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(tt){if(this.abortController=new globalThis.AbortController,this._options.signal){let n=this._options.signal;this._options.signal.addEventListener("abort",()=>{this.abortController.abort(n.reason)})}this._options.signal=this.abortController.signal}if(Z&&(this._options.duplex="half"),this._options.json!==void 0&&(this._options.body=this._options.stringifyJson?.(this._options.json)??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){let s="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),a=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,s);(rt&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(a,{...this.request}),this._options)}}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount<=this._options.retry.limit&&!(t instanceof v)){if(t instanceof _){if(!this._options.retry.statusCodes.includes(t.response.status))return 0;let o=t.response.headers.get("Retry-After");if(o&&this._options.retry.afterStatusCodes.includes(t.response.status)){let n=Number(o)*1e3;Number.isNaN(n)&&(n=Date.parse(o)-Date.now());let s=this._options.retry.maxRetryAfter??n;return n<s?n:s}if(t.response.status===413)return 0}let r=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,r)}return 0}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(r){let o=Math.min(this._calculateRetryDelay(r),N);if(o!==0&&this._retryCount>0){await F(o,{signal:this._options.signal});for(let n of this._options.hooks.beforeRetry)if(await n({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===D)return;return this._retry(t)}throw r}}async _fetch(){for(let o of this._options.hooks.beforeRequest){let n=await o(this.request,this._options);if(n instanceof Request){this.request=n;break}if(n instanceof Response)return n}let t=ct(this.request,this._options),r=this.request;return this.request=r.clone(),this._options.timeout===!1?this._options.fetch(r,t):z(r,t,this.abortController,this._options)}_stream(t,r){let o=Number(t.headers.get("content-length"))||0,n=0;return t.status===204?(r&&r({percent:1,totalBytes:o,transferredBytes:n},new Uint8Array),new globalThis.Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(s){let a=t.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:o},new Uint8Array);async function i(){let{done:l,value:u}=await a.read();if(l){s.close();return}if(r){n+=u.byteLength;let f=o===0?0:n/o;r({percent:f,transferredBytes:n,totalBytes:o},u)}s.enqueue(u),await i()}await i()}}),{status:t.status,statusText:t.statusText,headers:t.headers})}};var K=e=>{let t=(r,o)=>k.create(r,S(e,o));for(let r of A)t[r]=(o,n)=>k.create(o,S(e,n,{method:r}));return t.create=r=>K(S(r)),t.extend=r=>K(S(e,r)),t.stop=D,t},It=K(),Q=It;var qt="https://index.crates.io";async function ft(e,t=qt){let r=e.replace(/"/g,"").toLocaleLowerCase(),o="";r.length<=2?o=r.length.toString():r.length===3?o="3/"+r.substring(0,1):o=r.substring(0,2)+"/"+r.substring(2,4);let n=await Q.get(`${t}/${o}/${r}`);if(n.status!==200)throw new Error(`get crates metadata error: statusCode=${n.status} ${await n.text()}`);let s=(await n.text()).split(`
`).filter(f=>f),a=[],i={},l={},u=[];for(let f of s){let c=JSON.parse(f);if(c.yanked===!1){let d=q(c.vers);a.push(d),c.rust_version&&(l[c.vers]=c.rust_version),i[d]=Object.keys(c.features).filter(p=>p==="default"?(u=c.features.default.map(m=>q(m)),!1):!0).map(p=>q(p))}}return a=a.reverse(),{name:e,versions:a,features:i,defaultFeatures:u,rustVersion:l,createdAt:new Date().getUTCMilliseconds()}}async function W(e){if(e==="")return[];let t=await Q.get("https://crates.io/api/v1/crates?page=1&per_page=30&q="+e,{headers:{"User-Agent":"VSCodeExtension/crates-cmp"}});if(t.status!==200)throw new Error(`search crate error: statusCode=${t.status} ${await t.text()}`);return(await t.json()).crates}async function L(e,t){let r=jt(t),o=e.globalState.get(r);if(!o||o.createdAt>new Date().getUTCMilliseconds()-1e3*60*10){let n=await ft(t);return e.globalState.update(r,n),n}return o}function jt(e){return`crates-cmp:metadata:${e}`}async function pt(e,t){return(await L(e,t)).versions}var O=Symbol("None"),P=class e{val;constructor(t){this.val=t}get[Symbol.toStringTag](){return"Option"}*[Symbol.iterator](){this.isSome()&&(yield this.val)}isSome(){return this.val!==O}isNone(){return this.val===O}expect(t){if(this.isNone())throw new Error(t);return this.val}unwrap(){if(this.isNone())throw new Error("Unwrap called on None");return this.val}unwrapOr(t){return this.isNone()?t:this.val}unwrapOrElse(t){return this.isNone()?t():this.val}map(t){return this.isSome()?new e(t(this.val)):this}mapOr(t,r){return this.isSome()?r(this.val):t}or(t){return this.isSome()?this:t}okOr(t){return this.isSome()?C(this.val):E(t)}peek(){return this.val}flatten(){return this.val instanceof e?this.val:this}static from(t){let r=t();return r==null?new e(O):new e(r)}static async fromAsync(t){let r=await t();return r==null?new e(O):new e(r)}};function M(e){return new P(e)}Object.defineProperty(M,Symbol.hasInstance,{value:e=>typeof e!="object"?!1:e?.isSome()||!1});function U(){return new P(O)}Object.defineProperty(U,Symbol.hasInstance,{value:e=>typeof e!="object"?!1:e?.isNone()||!1});var R=class e{val;constructor(t){this.val=t}get[Symbol.toStringTag](){return"Result"}*[Symbol.iterator](){this.isOk()&&(yield this.val)}isOk(){return!(this.val instanceof Error||this.val&&typeof this.val=="object"&&Error.isPrototypeOf(this.val))}isErr(){return this.val instanceof Error||this.val&&typeof this.val=="object"&&Error.isPrototypeOf(this.val)}formatError(t){throw t.stack=`${t.message}: ${this.val.stack?`
	`+this.val.stack.split(`
`).join(`
	`):this.val.message}`,t}expect(t){return this.isErr()&&this.formatError(new Error(t)),this.val}expectErr(t){return this.isOk()&&this.formatError(new Error(t)),this.val}unwrap(){return this.isErr()&&this.formatError(new Error(`Unwrap called on ${this.val.name}`)),this.val}unwrapErr(){if(this.isOk())throw new Error(`UnwrapError called on value - ${this.val}`);return this.val}unwrapOr(t){return this.isErr()?t:this.val}unwrapOrElse(t){return this.isErr()?t(this.val):this.val}map(t){return this.isOk()?new e(t(this.val)):this}mapErr(t){return this.isOk()?this:new e(t(this.val))}mapOr(t,r){return this.isOk()?r(this.val):t}or(t){return this.isOk()?this:t}ok(){return this.isOk()?M(this.val):U()}peek(){return this.val}throw(){if(this.isErr())throw this.val}flatten(){return this.val instanceof e?this.val:this}static from(t){try{return new e(t())}catch(r){return new e(r)}}static async fromAsync(t){try{return new e(await t())}catch(r){return new e(r)}}static partition(t){return t.reduce((r,o)=>(o.isOk()?r.ok.push(o.unwrap()):r.err.push(o.unwrapErr()),r),{ok:[],err:[]})}};function C(e){return new R(e)}Object.defineProperty(C,Symbol.hasInstance,{value:e=>typeof e!="object"?!1:e?.isOk()||!1});function E(e){return typeof e=="string"?new R(new Error(e)):new R(e)}Object.defineProperty(E,Symbol.hasInstance,{value:e=>typeof e!="object"?!1:e?.isErr()||!1});async function h(e){try{let t=await e;return C(t)}catch(t){return E(t)}}async function mt(e,t,r,o){if(t==="")return[];let n=await h(L(e,t));if(n.isErr())throw n.unwrapErr();let s=n.unwrap();if(o&&o.length!==0){let a=s.features[r]??[],i={};for(let l of o)i[l]=!0;return a.filter(l=>!i[l])}return r!==""&&s.features[r]?s.features[r]:s.versions.length!==0?s.features[s.versions[s.versions.length-1]]??[]:[]}var y=require("vscode");async function Y(e,t,r){let o=await h(pt(e,t));if(o.isErr())return y.window.showErrorMessage(o.unwrapErr().message),[];let n=o.unwrap().map((s,a)=>{let i=new y.CompletionItem(s,y.CompletionItemKind.Constant);return i.insertText=s,i.sortText=b(a++),i.preselect=a===0,i.range=r,i});return new y.CompletionList(n)}var ht=require("vscode");function dt(e,t){return new Promise((r,o)=>{ht.commands.executeCommand(e,t).then(n=>{G(n)&&o("symbol provider undefined"),r(n)},n=>o(n))})}var w=require("vscode");async function gt(e,t,r,o,n){let s=await h(mt(e,t,r,o));if(s.isErr())return w.window.showErrorMessage(s.unwrapErr().message),[];let a=s.unwrap().map((i,l)=>{let u=new w.CompletionItem(i,w.CompletionItemKind.Constant);return u.insertText=i,u.sortText=b(l++),u.preselect=l===0,u.range=n,u});return new w.CompletionList(a)}async function yt(e){return W(e)}var g=require("vscode");async function wt(e,t){let r=At(e,t),o=await h(yt(r));if(o.isErr())return g.window.showErrorMessage(o.unwrapErr().message),[];let[n,s]=Nt(r);return o.unwrap().map((i,l)=>{let u=new g.CompletionItem(i.name,g.CompletionItemKind.Constant);return u.insertText=i.name,u.documentation=i.description,u.detail="max version: "+i.max_version,u.sortText=b(l++),u.preselect=l===0,u.range=new g.Range(t.line,n,t.line,s),u})}function At(e,t){let r=new g.Range(t.line,0,t.line,t.character);return e.getText(r)}function Nt(e){let t=-1,r=-1;for(let o=0;o<e.length;o++)e[o].trim()!==""&&(t===-1&&(t=o),r=o);return[t,r]}var $=class{context;constructor(t){this.context=t}provideCompletionItems(t,r,o,n){return new Promise(async s=>{let a=await this.completionItems(t,r,o,n);s(a)})}async completionItems(t,r,o,n){let s=await h(dt("vscode.executeDocumentSymbolProvider",t.uri));if(s.isErr())return xt.window.showErrorMessage("Require `Even Better TOML` extension"),[];let a=s.unwrap(),i=!1,l=!1,u,f,c,d;for(let p of a)if(p.name.includes("dependencies")&&(i=!0,p.range.contains(r)&&p.children&&p.children.length>0)){for(let m of p.children)if(m.range.contains(r)&&(u=m.name,f=m.range,m.children&&m.children.length>0)){l=!0;for(let x of m.children)x.name==="version"&&(c=x),x.name==="features"&&(d=x)}}if(!i)return[];if(u){if(c&&c.range.contains(r))return await Y(this.context,u,c.range);if(d&&d.children.length!==0){if(d.range.contains(r)){let p=t.getText(c?.range),m,x=[];for(let B of d.children){if(B.range.contains(r)){m=B.range;continue}x.push(t.getText(B.range))}return await gt(this.context,u,p,x,m)}return[]}if(!l)return await Y(this.context,u,f)}return await wt(t,r)}};function Lt(e){let t={language:"toml",pattern:"**/[Cc]argo.toml"};console.log('Congratulations, your extension "crates-cmp" is now active!'),e.subscriptions.push(H.workspace.onDidChangeTextDocument(r=>{}),H.languages.registerCompletionItemProvider(t,new $(e),'"',".","+","-","0","1","2","3","4","5","6","7","8","9"))}function Mt(){}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

ky/distribution/index.js:
  (*! MIT License © Sindre Sorhus *)
*/
